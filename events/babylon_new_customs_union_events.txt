namespace = babylon_new_customs_union
babylon_new_customs_union.1 = {
	#Ends the customs union play if nobody joined against it, and nobody can join it no more
	#Or if it goes to war, in case of bad rolls
	hidden = yes
	type = country_event
	trigger = {
		has_variable_list = babylon_new_customs_union_overlord
		any_diplomatic_play = {
			initiator_is = root
			OR = {
				is_war = yes
				escalation >= 80
			}
			is_diplomatic_play_type = dp_customs_union
			target = {
				has_variable_list = babylon_new_customs_union_applicant
			}
		}
	}
	immediate = {
		random_diplomatic_play = {
			limit = {
				initiator_is = root
				OR = {
					is_war = yes
					escalation >= 80
				}
				is_diplomatic_play_type = dp_customs_union
				target = {
					has_variable_list = babylon_new_customs_union_applicant
				}
			}
			target = {
				clear_variable_list = babylon_new_customs_union_applicant
			}
			end_play = yes
		}
		clear_variable_list = babylon_new_customs_union_overlord
	}
}

babylon_new_customs_union.2 = {
	#Fires on liberate subject war end, if you're the applicant, since they should always be in this war until the end... Hopefully
	hidden = yes
	type = country_event
	trigger = {
		has_variable_list = babylon_new_customs_union_applicant
	}
	immediate = {
		save_scope_as = applicant_scope
		every_in_list = {
			variable = babylon_new_customs_union_applicant
			save_scope_as = overlord_scope
		}
		random_country = {
			limit = {
				has_truce_with = scope:overlord_scope
				has_variable = babylon_new_customs_union_objector
			}
			save_scope_as = objector_scope
		}
		if = {
			#If the applicant is no longer a customs union subject to the overlord...
			limit = {
				NAND = {
					is_subject_type = subject_type_customs_union
					is_subject_of = scope:overlord_scope
				}
			}
			#Assume they lost the war, and create a truce and a 5 year timer where they cant join another market
			create_truce = {
				country = scope:overlord_scope
				months = 60				#5 years, standard
			}
			set_variable = {
				name = babylon_new_customs_union_applicant_denied
				value = 1
				days = 1826				#5 years
			}
		}
		clear_variable_list = babylon_new_customs_union_applicant
		scope:objector_scope = {
			remove_variable = babylon_new_customs_union_objector
		}
		scope:overlord_scope = {
			clear_variable_list = babylon_new_customs_union_overlord
		}
	}
}

babylon_new_customs_union.3 = {
	#Create the diplo play... Has to be done in this way
	#Fires for overlord
	hidden = yes
	type = country_event
	trigger = {
	}
	immediate = {
		every_in_list = {
			#Checks its varaible list to find the applicant, then saves it in scope
			variable = babylon_new_customs_union_overlord
			save_scope_as = applicant_scope
		}
		create_diplomatic_play = {
			type = dp_customs_union
			target_country = scope:applicant_scope
			add_war_goal = {
				holder = scope:applicant_scope
				type = humiliation
				target_country = root
			}
		}
	}
}
babylon_new_customs_union.4 = {
	type = country_event
	event_image = {
		video = "gfx/event_pictures/unspecific_vandalized_storefront.bk2"
	}
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/unspecific/vandalized_storefront"
	icon = "gfx/interface/icons/event_icons/event_newspaper.dds"
	title = infamy_rebalance.4.t
	desc = infamy_rebalance.4.d
	flavor = infamy_rebalance.4.f
	duration = 3
	option = {
		name = "war fired for you"
	}
}